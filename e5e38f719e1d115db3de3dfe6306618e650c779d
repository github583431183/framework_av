{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "224df6c8_13fe05dc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-20T00:46:51Z",
      "side": 1,
      "message": "LGTM, I\u0027ve added Eric for the final approval.",
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "044badb3_61cbad5b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-20T02:19:41Z",
      "side": 1,
      "message": "The failures indicate that there will be conflicts downstream would we have this fix merged. So after Eric\u0027s approval, I will first submit it downstream after resolving conflicts, then will apply this patch in AOSP. Michael, there is nothing for you to worry about.",
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8a561bb7_ff2b02e7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "looks fine excepting some nits. would prefer clarification on the creation and restoration of MSD patches.  it isn\u0027t perfect, though i\u0027m not seeing a great solution to this off-hand.",
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79dc487f_30aaf6b3",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1040,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "by specifying the outputDevices, seems we are using devices created by line 1012 vs line 1453 (AUDIO_USAGE_MEDIA).",
      "range": {
        "startLine": 1040,
        "startChar": 62,
        "endLine": 1040,
        "endChar": 75
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb0fe824_7afbeee4",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1040,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "Yes, we give preference to patching to the requested device.",
      "parentUuid": "79dc487f_30aaf6b3",
      "range": {
        "startLine": 1040,
        "startChar": 62,
        "endLine": 1040,
        "endChar": 75
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fa6feb2f_5f41cede",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1040,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-29T23:09:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "eb0fe824_7afbeee4",
      "range": {
        "startLine": 1040,
        "startChar": 62,
        "endLine": 1040,
        "endChar": 75
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b2901eb6_5b6395e8",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1203,
      "author": {
        "id": 1003259
      },
      "writtenOn": "2021-01-20T08:21:13Z",
      "side": 1,
      "message": "I don\u0027t think we should only consider the first device address as we did before with a single MSD patch.\nWe should consider each device type/address in devices vector individually for a match",
      "range": {
        "startLine": 1203,
        "startChar": 31,
        "endLine": 1203,
        "endChar": 38
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0de40d33_e8bdb828",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1203,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-20T17:37:52Z",
      "side": 1,
      "message": "Yes, I missed that. Sure, each device has it\u0027s own address (which may be empty of course).",
      "parentUuid": "b2901eb6_5b6395e8",
      "range": {
        "startLine": 1203,
        "startChar": 31,
        "endLine": 1203,
        "endChar": 38
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e055c594_f16eef14",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1203,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "+1, no need to specify the address, it is in the device itself.",
      "parentUuid": "0de40d33_e8bdb828",
      "range": {
        "startLine": 1203,
        "startChar": 31,
        "endLine": 1203,
        "endChar": 38
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05ce375a_74095829",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1203,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "That makes sense. No need for the address parameter. I can rely solely on the DeviceVector argument for matching device type/address pairs individually.",
      "parentUuid": "e055c594_f16eef14",
      "range": {
        "startLine": 1203,
        "startChar": 31,
        "endLine": 1203,
        "endChar": 38
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7c21a77_d27eeaa9",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1203,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-29T23:09:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "05ce375a_74095829",
      "range": {
        "startLine": 1203,
        "startChar": 31,
        "endLine": 1203,
        "endChar": 38
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23b9fd76_450333c7",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1464,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "// Retain only the MSD patches associated with outputDevices request.\n// Tear down the others, and create new ones as needed.",
      "range": {
        "startLine": 1462,
        "startChar": 0,
        "endLine": 1464,
        "endChar": 59
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "04f90434_06851c81",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1464,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "23b9fd76_450333c7",
      "range": {
        "startLine": 1462,
        "startChar": 0,
        "endLine": 1464,
        "endChar": 59
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f1b9268_2c01c48f",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1498,
      "author": {
        "id": 1003259
      },
      "writtenOn": "2021-01-20T08:21:13Z",
      "side": 1,
      "message": "ALOGD",
      "range": {
        "startLine": 1498,
        "startChar": 12,
        "endLine": 1498,
        "endChar": 17
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dae6c6b2_003d28c4",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1498,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9f1b9268_2c01c48f",
      "range": {
        "startLine": 1498,
        "startChar": 12,
        "endLine": 1498,
        "endChar": 17
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c425b36c_46e499f6",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1509,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "do we need this?  This is a property of the device in the devices vector (and the devices vector ought to be filtered before coming here).  If you want the first device, then make sure devices has only the first element.",
      "range": {
        "startLine": 1509,
        "startChar": 70,
        "endLine": 1509,
        "endChar": 94
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00a03afd_90b127e6",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1509,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "We don\u0027t need the address parameter, I will remove it from the signature of this method.",
      "parentUuid": "c425b36c_46e499f6",
      "range": {
        "startLine": 1509,
        "startChar": 70,
        "endLine": 1509,
        "endChar": 94
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9839a304_862210ee",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1509,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-29T23:09:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "00a03afd_90b127e6",
      "range": {
        "startLine": 1509,
        "startChar": 70,
        "endLine": 1509,
        "endChar": 94
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef2a1334_8cf12b9a",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1516,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "does devices.getDevice(sink-\u003eext.device.type, sink-\u003eext.device.address, AUDIO_FORMAT_DEFAULT) !\u003d nullptr work here?\n\n\nhttps://cs.android.com/android/platform/superproject/+/master:frameworks/av/services/audiopolicy/common/managerdefinitions/include/DeviceDescriptor.h;drc\u003d4e82621821c5adf1dbd3ef1911fc6a2a0becfbc8;l\u003d126",
      "range": {
        "startLine": 1516,
        "startChar": 20,
        "endLine": 1516,
        "endChar": 76
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39870f14_c45693cd",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1516,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "Yes, I think that would work here. I\u0027ll use that approach.",
      "parentUuid": "ef2a1334_8cf12b9a",
      "range": {
        "startLine": 1516,
        "startChar": 20,
        "endLine": 1516,
        "endChar": 76
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "89d3d6f0_2ab12296",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 1516,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-29T23:09:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "39870f14_c45693cd",
      "range": {
        "startLine": 1516,
        "startChar": 20,
        "endLine": 1516,
        "endChar": 76
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e974a33_51fe8b61",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5348,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "this may not restore the same patches that were removed on line 1203.  Seems like we could cache how we built them (i.e. how we created the outputDevices).  here and on line 5415.  See comment above on the differences (e.g. one uses AUDIO_USAGE_MEDIA).   This is a bit difficult because the devices available might have changed...  Maybe Eric has a suggestion here.",
      "range": {
        "startLine": 5348,
        "startChar": 25,
        "endLine": 5348,
        "endChar": 28
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d7ce631_96770860",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5348,
      "author": {
        "id": 1281351
      },
      "writtenOn": "2021-01-21T22:00:11Z",
      "side": 1,
      "message": "Happy to hear your suggestions on this one.",
      "parentUuid": "4e974a33_51fe8b61",
      "range": {
        "startLine": 5348,
        "startChar": 25,
        "endLine": 5348,
        "endChar": 28
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d30a04f_eda0f467",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5348,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-22T17:23:13Z",
      "side": 1,
      "message": "Ha - that\u0027s why I gave it a +1 :-).  I am ok with it as is - my rationale is that this CL doesn\u0027t cause a regression from prior behavior and an improvement could be done with a subsequent CL.  But perhaps we should put in TODO comments as to the behavior to fix.\n\nI think in this spot, resetting the MSD patches with no active AudioTrack is benign - any delta changes required would be applied when the new AudioTrack is created.  However, if there is an active AudioTrack, this can cause unnecessary routing changes and glitching to the MSD playback experience.\n\nA brute force solution would be to convert setMsdPatches to take an attr and device. Those parameters would be cached for restoration.  Compare the following calls line 1012 vs line 1453\n\n outputDevices \u003d mEngine-\u003egetOutputDevicesForAttributes(*resultAttr, requestedDevice, false);\n\n outputDevices \u003d mEngine-\u003egetOutputDevicesForAttributes(\n                    attributes_initializer(AUDIO_USAGE_MEDIA), nullptr, false /*fromCache*/);\n\nSo previously used attr and device would be sufficient to restore the original desired behavior.  It is not as elegant as I would have liked, and to be honest, I don\u0027t have that much experience with MSD and AudioPolicy - maybe there is something better.",
      "parentUuid": "1d7ce631_96770860",
      "range": {
        "startLine": 5348,
        "startChar": 25,
        "endLine": 5348,
        "endChar": 28
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2b46ee00_2d210683",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5348,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-29T23:09:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1d30a04f_eda0f467",
      "range": {
        "startLine": 5348,
        "startChar": 25,
        "endLine": 5348,
        "endChar": 28
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00d0f9a9_460d6b54",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5415,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-21T18:12:05Z",
      "side": 1,
      "message": "ditto",
      "range": {
        "startLine": 5415,
        "startChar": 8,
        "endLine": 5415,
        "endChar": 21
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84d67cf6_a314c5e6",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5415,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2021-01-22T17:23:13Z",
      "side": 1,
      "message": "Here, a device configuration change might reroute an active AudioTrack.  If that causes invalidation, it is likely that the AudioTrack with special routing requests will get rerouted correctly when the AudioTrack is recreated by the line in 1012.  In any case, I think it is better to do it correctly here as the setMsdPatches() code properly suppresses unnecessary patch changes and would avoid glitchy rerouting.",
      "parentUuid": "00d0f9a9_460d6b54",
      "range": {
        "startLine": 5415,
        "startChar": 8,
        "endLine": 5415,
        "endChar": 21
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "be640907_a489e320",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 3
      },
      "lineNbr": 5415,
      "author": {
        "id": 1042638
      },
      "writtenOn": "2021-01-29T23:09:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "84d67cf6_a314c5e6",
      "range": {
        "startLine": 5415,
        "startChar": 8,
        "endLine": 5415,
        "endChar": 21
      },
      "revId": "e5e38f719e1d115db3de3dfe6306618e650c779d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}