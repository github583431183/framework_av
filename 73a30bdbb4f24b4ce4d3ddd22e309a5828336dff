{
  "comments": [
    {
      "key": {
        "uuid": "723ead8b_d942c102",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2018-03-14T23:49:05Z",
      "side": 1,
      "message": "i believe this should be done in clearInputBuffer_l()",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0c5fc04e_b8e1971e",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-16T01:20:50Z",
      "side": 1,
      "message": "Hi Andy,\nThank you for your comment.\nI\u0027m not sure about moving it to clearInputBuffer_l() since clearInputBuffer_l() is called many times from EffectChain::process_l().\nCould you give me your advice if we still should move it to clearInputBuffer_l()?",
      "parentUuid": "723ead8b_d942c102",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e21e4c5f_8e7a335d",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2018-03-16T02:00:33Z",
      "side": 1,
      "message": "you\u0027re right, i overlooked the draining. i had a knee-jerk reaction :-) to something being in the external call but not the internal locked version.\n\non review, i\u0027m not sure if this reset is suitable in clearInputBuffer() either since this is invoked for underruns, which may very well be intentional by the application.\n\nCould the pop be avoided by traditional means?  a volume ramp to 0 on the current track (we have the VolumeShaper) and then a ramp up on the next track?  Perhaps a cross-fade?",
      "parentUuid": "0c5fc04e_b8e1971e",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "43657cd7_676237f7",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-16T07:13:09Z",
      "side": 1,
      "message": "Hi Andy,\n\nSorry I could not understand what your below comment means. \n\"i\u0027m not sure if this reset is suitable in clearInputBuffer() either since this is invoked for underruns, which may very well be intentional by the application.\"\n\nWhat kind of problem could happen with this change?",
      "parentUuid": "e21e4c5f_8e7a335d",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a150df29_6b054771",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2018-03-16T07:19:38Z",
      "side": 1,
      "message": "If an application simply stopped writing AudioTrack data, the remaining buffered data should eventually drain out (triggering the underrun).  If we called reset here, it seems that would prematurely cut off the tail of the effect.",
      "parentUuid": "43657cd7_676237f7",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d767c35_ee82419d",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-16T07:26:46Z",
      "side": 1,
      "message": "OK.. I got it. I\u0027m not sure if it causes actual problem from end user perspective since application stops playback intentionally in this case. Do you think the current change is not acceptable?",
      "parentUuid": "a150df29_6b054771",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a99aa882_43cdb5ab",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2018-03-16T07:30:38Z",
      "side": 1,
      "message": "With a track change, I\u0027m wondering if volume ramping / fade / cross fade is the right approach instead.  Traditionally these have been used to avoid pops.",
      "parentUuid": "1d767c35_ee82419d",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8f1710e_c24b0508",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2018-03-16T07:34:39Z",
      "side": 1,
      "message": "By that comment, the application becomes responsible for ensuring audio seamlessness by the data it sends, rather than imposing the burden on the underlying engine.  We have tools such as the VolumeShaper to make this easier.  I\u0027m not exactly sure your case of track switching, so if you can elaborate why reset must be done in the server, that would help me understand better, thanks!",
      "parentUuid": "a99aa882_43cdb5ab",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "703b46d7_23ea5ff0",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-16T12:37:34Z",
      "side": 1,
      "message": "Hi Andy,\nSorry I still can not imagine how we can implement to avoid the pop by using VolumeShaper etc. Our effect engine has an internal buffer so it should be consumed when switching track, and I think one of the simplest way is to flush the buffer. It also might be avoided by volume ramping / fade but the ramp duration depends on the internal buffer so I still can not imagine how to implement it.\nIf reset is acceptable in this case, I would like to use reset.",
      "parentUuid": "d8f1710e_c24b0508",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef2738ad_e09cf122",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-16T12:37:34Z",
      "side": 1,
      "message": "Hi Andy,\nAs far as we tried, clearInputBuffer_l() is called many times so",
      "parentUuid": "723ead8b_d942c102",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77960c12_9078169b",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-16T12:39:27Z",
      "side": 1,
      "message": "\u003e Hi Andy,\n \u003e As far as we tried, clearInputBuffer_l() is called many times so\n\nSorry please ignore above.",
      "parentUuid": "ef2738ad_e09cf122",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "73c57db3_e191843f",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-03-26T04:55:13Z",
      "side": 1,
      "message": "Hi Andy,\nDo you have any comment? It is very much appreciated if you could give me your advice.",
      "parentUuid": "77960c12_9078169b",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "75053ae3_c8cf5c86",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1040213
      },
      "writtenOn": "2018-03-26T18:43:56Z",
      "side": 1,
      "message": "The issue is that we may do a reset here to prevent effect continuity on underrun or track change, but another application may rely on effect continuity.  I\u0027m not convinced the reset here is always a good thing.\n\nIdeally the application that wanted to prevent effect continuity would \"disable/enable\" the effect at the track stop/change. Unfortunately there is no good way to attempt this synchronization.  I\u0027m wondering if it is possible to use different session ids to separate out the effect behaviors between different tracks and attempting to disable the associated track effect processing when the original track stops.\n\nCan you please help explain exactly the problematic behavior, referring to tracks, effects, sessions, operations. scenarios involved?  Thanks!",
      "parentUuid": "73c57db3_e191843f",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d013b1ec_7153226f",
        "filename": "services/audioflinger/Effects.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1596,
      "author": {
        "id": 1243029
      },
      "writtenOn": "2018-05-11T00:33:10Z",
      "side": 1,
      "message": "I\u0027m not sure if this can answer for you but please let me share the figure to explain what happens.\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n0 process\n                       Effect________\n                      |              |\nAudioMixer            |buffer        |        AudioHAL\n                      |  _________   |\n                      | |No Sound |  |\n                      | |_________|  |\n                      |______________|\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n1st process\n\n                       Effect________\n                      |              |\nAudioMixer ---------\u003e |buffer        | ------\u003e AudioHAL\n           1st frames |  __________  | No Sound output\n                      | |1st frames| |\n                      | |__________| |\n                      |______________|\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n2nd process\n\n                       Effect________\n                      |              |\nAudioMixer ---------\u003e |buffer        | ------\u003e AudioHAL\n           2nd frames |  __________  | 1st frames output\n                      | |2nd frames| |\n                      | |__________| |\n                      |______________|\n\nFor example, when the content transitions to the next song at this timing,\nThe 2nd frames remains in the Effect engine.\nWe do not have good idea to solve this issue without calling reset().",
      "parentUuid": "75053ae3_c8cf5c86",
      "range": {
        "startLine": 1594,
        "startChar": 0,
        "endLine": 1596,
        "endChar": 5
      },
      "revId": "73a30bdbb4f24b4ce4d3ddd22e309a5828336dff",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}