{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8b525b29_aa261b64",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-12-14T20:53:19Z",
      "side": 1,
      "message": "Note that LOG_FATAL_IF() is a no-op for release builds, so unless you\u0027re actively opting into debug builds, this line does nothing.  Did you originally want LOG_ALWAYS_FATAL_IF() ?",
      "revId": "65c69569aabe1ded220be7ed393a19ec4bcd4932",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2900c95d_69c4007a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-12-14T20:57:04Z",
      "side": 1,
      "message": "Reading from my own notes when I found this, this fix is not likely all that is needed, since AImageReader_newWithUsage() deletes an AImageReader instance without closing it, in the case of a failed initialization: https://cs.android.com/android/platform/superproject/+/master:frameworks/av/media/ndk/NdkImageReader.cpp;l\u003d741?q\u003dAImageReader_newWithUsage.  That would trigger this LOG_FATAL, which I don\u0027t believe is intended.",
      "revId": "65c69569aabe1ded220be7ed393a19ec4bcd4932",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9057ed60_06b077ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1121338
      },
      "writtenOn": "2020-12-14T21:07:46Z",
      "side": 1,
      "message": "Thank you for the fix!",
      "revId": "65c69569aabe1ded220be7ed393a19ec4bcd4932",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e272ee1_d7e6b520",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1064128
      },
      "writtenOn": "2020-12-14T22:31:40Z",
      "side": 1,
      "message": "Let me know if you want me to submit this, since it should be strictly better than the current situation, but there is still some work possible to improve it, which I don\u0027t have enough context to handle.",
      "parentUuid": "2900c95d_69c4007a",
      "revId": "65c69569aabe1ded220be7ed393a19ec4bcd4932",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "89a7a97a_9c5ea141",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1121338
      },
      "writtenOn": "2020-12-15T00:06:09Z",
      "side": 1,
      "message": "Thanks for going through that scenario. At the top of my head I think we might want to add an mInit boolean and check that before the LOG_FATAL_IF. The LOG_FATAL_IF was added as a part of the fix for b/137694217, to make the client process crash if we hit a certain deadlock path. I think its nice to have this fix (and submit a change that would also prevent the LOG_FATAL from trigerring on AImageReader_newWithUsage failing). I\u0027ll try to get a CL for the mInit check tonight and we can hopefully submit that along with this CL.",
      "parentUuid": "9e272ee1_d7e6b520",
      "revId": "65c69569aabe1ded220be7ed393a19ec4bcd4932",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}