{
  "comments": [
    {
      "key": {
        "uuid": "4e30a247_0f221909",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1003259
      },
      "writtenOn": "2020-05-06T17:01:16Z",
      "side": 1,
      "message": "we need to understand how this can happen: th way the cache works is that it should be updated whenever a device is added or removed or when the routing rules change (e.g forced usage).\nIt is normally safe to use the cache from methods not changing the routing rules",
      "range": {
        "startLine": 10,
        "startChar": 31,
        "endLine": 11,
        "endChar": 67
      },
      "revId": "9ea28e7583690e9ea8bac31662f91f7dce35416d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d712c055_646d6946",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1491204
      },
      "writtenOn": "2020-05-06T17:04:35Z",
      "side": 1,
      "message": "definitely, it is done by setDeviceConnection state at the end, but too late. no doubt here the choice from cache was intentional, I wish you could remember why ;-)\n\nI will investigate more tomorrow",
      "parentUuid": "4e30a247_0f221909",
      "range": {
        "startLine": 10,
        "startChar": 31,
        "endLine": 11,
        "endChar": 67
      },
      "revId": "9ea28e7583690e9ea8bac31662f91f7dce35416d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4605b659_1613e28f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1491204
      },
      "writtenOn": "2020-05-07T11:19:50Z",
      "side": 1,
      "message": "Here is the sequence:\n1/ setDeviceConnectionStateInt UNAVAILABLE\n\t2/checkForDeviceAndOutputChanges\n\t\t3/checkOutputForAllStrategies\n\t\t\t4/checkOutputForAttributes  -\u003e Cannot update cache as need previous / new device for attributes\n\t\t\t\t5/connectAudioSource\n\t\t3-1/updateDevicesAndOutputs();\n\n\t2-1/updateDevicesAndOutputs();\n\n\nSo 2 solutions within :connectAudioSource Either do not use cache or bailing out instead of ALOG_ASSERT(!sinkDevices.isEmpty(), \"connectAudioSource(): no device found for attributes\");",
      "parentUuid": "d712c055_646d6946",
      "range": {
        "startLine": 10,
        "startChar": 31,
        "endLine": 11,
        "endChar": 67
      },
      "revId": "9ea28e7583690e9ea8bac31662f91f7dce35416d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "328ea0c0_2d3b7eb3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1491204
      },
      "writtenOn": "2020-05-07T16:19:11Z",
      "side": 1,
      "message": "After a long day of fight, I came to the conclusion that only not from cache is viable. If we do not use from cache, and if the AudioSource could not be rerouted on another device while the given sink was disconnected, I will not be reconnected on newly available device.\n\nBTW: I added this case in my functional tests of disconnecting the source to identify all these potential fix.",
      "parentUuid": "4605b659_1613e28f",
      "range": {
        "startLine": 10,
        "startChar": 31,
        "endLine": 11,
        "endChar": 67
      },
      "revId": "9ea28e7583690e9ea8bac31662f91f7dce35416d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6864d59_2b306297",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 11,
      "author": {
        "id": 1003259
      },
      "writtenOn": "2020-05-07T17:04:09Z",
      "side": 1,
      "message": "OK, in the context of checkOutputForAttributes it is legit to not use the cache",
      "parentUuid": "328ea0c0_2d3b7eb3",
      "range": {
        "startLine": 10,
        "startChar": 31,
        "endLine": 11,
        "endChar": 67
      },
      "revId": "9ea28e7583690e9ea8bac31662f91f7dce35416d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a49c501_49b04a2f",
        "filename": "services/audiopolicy/managerdefault/AudioPolicyManager.cpp",
        "patchSetId": 1
      },
      "lineNbr": 5005,
      "author": {
        "id": 1003259
      },
      "writtenOn": "2020-05-06T17:01:16Z",
      "side": 1,
      "message": "we should maybe change the logic that decides to close an output so that an output used by a SW audio patch is not closed.",
      "range": {
        "startLine": 5005,
        "startChar": 0,
        "endLine": 5005,
        "endChar": 80
      },
      "revId": "9ea28e7583690e9ea8bac31662f91f7dce35416d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}